<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>英文提示詞生成器（TXT 詞庫）</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Arial; margin: 24px; line-height: 1.5; }
    h1 { margin: 0 0 8px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .card { border: 1px solid #ddd; border-radius: 14px; padding: 16px; margin: 14px 0; }
    button { padding: 10px 14px; border-radius: 10px; border: 1px solid #ccc; cursor: pointer; background: #fff; }
    button.primary { border-color: #111; }
    .grid { display: grid; gap: 10px; }
    .grid.cols-5 { grid-template-columns: repeat(5, minmax(0, 1fr)); }
    .grid.cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
    .pill { display: inline-flex; gap: 8px; align-items: center; padding: 8px 10px; border: 1px solid #ddd; border-radius: 12px; }
    .pill input { transform: translateY(1px); }
    .muted { color: #666; font-size: 12px; }
    #output { font-size: 16px; white-space: pre-wrap; word-break: break-word; }
    code { background: #f6f6f6; padding: 2px 6px; border-radius: 6px; }
    @media (max-width: 900px) {
      .grid.cols-5 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .grid.cols-4 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
  </style>
</head>
<body>
  <h1>英文提示詞生成器</h1>
  <div class="muted">資料來源：<code>/data/*.txt</code>（每個分類一個檔案，每行一個詞條）。</div>

  <div class="card">
    <h3 style="margin:0 0 10px">勾選要生成的類別</h3>

    <div class="row" style="justify-content: space-between; align-items: flex-start;">
      <div style="flex:1; min-width: 280px;">
        <h4 style="margin:10px 0 8px">服裝區</h4>
        <div class="grid cols-5" id="boxClothes"></div>
      </div>

      <div style="flex:1; min-width: 240px;">
        <h4 style="margin:10px 0 8px">場景區</h4>
        <div class="grid cols-4" id="boxScene"></div>

        <h4 style="margin:14px 0 8px">選項</h4>
        <label class="pill">
          <input type="checkbox" id="optNsfw">
          <span>添加 NSFW</span>
        </label>

        <div class="muted" style="margin-top:10px">
          輸出分隔：<br/>
          <label class="pill" style="margin-top:6px">
            <input type="checkbox" id="optNewline">
            <span>用換行分隔</span>
          </label>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:14px">
      <button id="btnAll">全選</button>
      <button id="btnNone">全不選</button>
      <button class="primary" id="btnGenerate">Generate</button>
      <button id="btnCopy">Copy</button>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 10px">輸出 Prompt</h3>
    <div id="output"></div>
    <div class="muted" style="margin-top:10px" id="status"></div>
  </div>

<script>
// ===== 1) 分類（中文顯示）=====
const GROUPS = {
  clothes: ["主題裝","泳裝","套裝","外套","上衣","褲","裙","內衣","內褲","襪"],
  scene: ["動作","表情","場景","鏡頭","羞恥","擦邊","R18"]
};

// 輸出順序
const OUTPUT_ORDER = [...GROUPS.clothes, ...GROUPS.scene];

// 可依分類包裝成更像句子的片語（可自行改）
const FORMATTERS = {
//  "場景": (t) => `in ${t}`,
  "R18": (t) => `${t} sex`
};

const NSFW_KEY = "NSFW";

// ===== 2) 資料來源：每個分類一個 txt 檔 =====
function fileUrl(category) {
  // 檔名使用中文：/data/外套.txt
  return `data/${encodeURIComponent(category)}.txt`;
}

function parseLines(text) {
  return text
    .split(/\r?\n/)
    .map(s => s.trim())
    .filter(s => s && !s.startsWith("#"));
}

function randPick(arr) {
  if (!arr || arr.length === 0) return "";
  return arr[Math.floor(Math.random() * arr.length)];
}

function formatTerm(category, term) {
  const f = FORMATTERS[category];
  return f ? f(term) : term;
}

// ===== 3) UI =====
function renderGroup(containerId, categories) {
  const box = document.getElementById(containerId);
  box.innerHTML = "";
  for (const c of categories) {
    const el = document.createElement("label");
    el.className = "pill";
    el.innerHTML = `<input type="checkbox" checked data-cat="${c}"> <span>${c}</span>`;
    box.appendChild(el);
  }
}

function getSelectedCategories() {
  return Array.from(document.querySelectorAll('input[type="checkbox"][data-cat]'))
    .filter(cb => cb.checked)
    .map(cb => cb.dataset.cat);
}

renderGroup("boxClothes", GROUPS.clothes);
renderGroup("boxScene", GROUPS.scene);

// ===== 4) 讀檔（有 cache，避免每次都 fetch）=====
const CACHE = new Map(); // category -> string[]

async function loadCategory(category) {
  if (CACHE.has(category)) return CACHE.get(category);

  const url = fileUrl(category);
  const res = await fetch(url, { cache: "no-store" });
  if (!res.ok) throw new Error(`讀取失敗：${url}（HTTP ${res.status}）`);

  const text = await res.text();
  const items = parseLines(text);
  CACHE.set(category, items);
  return items;
}

async function generatePrompt() {
  const selected = new Set(getSelectedCategories());
  const useNsfw = document.getElementById("optNsfw").checked;
  const useNewline = document.getElementById("optNewline").checked;

  const parts = [];
  const report = [];

  // 依順序載入並抽取
  for (const cat of OUTPUT_ORDER) {
    if (!selected.has(cat)) continue;
    const items = await loadCategory(cat);
    report.push(`${cat}: ${items.length}`);
    const picked = randPick(items);
    if (picked) parts.push(formatTerm(cat, picked));
  }

  // NSFW（勾選才載）
  if (useNsfw) {
    const items = await loadCategory(NSFW_KEY);
    report.push(`${NSFW_KEY}: ${items.length}`);
    const picked = randPick(items);
    if (picked) parts.push(picked);
  }

  const sep = useNewline ? "\n" : ", ";
  return { text: parts.join(sep), report: report.join(" | ") };
}

// ===== 5) 事件 =====
document.getElementById("btnGenerate").addEventListener("click", async () => {
  try {
    document.getElementById("output").textContent = "Generating...";
    const { text, report } = await generatePrompt();
    document.getElementById("output").textContent = text || "(空) - 請確認檔案有內容且已勾選分類";
    document.getElementById("status").textContent = report;
  } catch (e) {
    document.getElementById("output").textContent = "";
    document.getElementById("status").textContent = "";
    alert(e.message || String(e));
  }
});

document.getElementById("btnCopy").addEventListener("click", async () => {
  const text = document.getElementById("output").textContent.trim();
  if (!text) return;
  await navigator.clipboard.writeText(text);
  alert("Copied ✅");
});

document.getElementById("btnAll").addEventListener("click", () => {
  document.querySelectorAll('input[type="checkbox"][data-cat]').forEach(cb => cb.checked = true);
});

document.getElementById("btnNone").addEventListener("click", () => {
  document.querySelectorAll('input[type="checkbox"][data-cat]').forEach(cb => cb.checked = false);
});
</script>
</body>
</html>






